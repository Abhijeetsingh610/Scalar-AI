(()=>{var e={};e.id=384,e.ids=[384],e.modules={5236:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=5236,e.exports=r},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},9835:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>_,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var s={};t.r(s),t.d(s,{POST:()=>i});var o=t(3277),n=t(5265),a=t(5356),l=t(7076);let u=(0,t(459).eI)("https://pmfpiliekzujamlrcvkp.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function i(e){try{let{courseId:r,leadId:t,paymentAmount:s}=await e.json();if(!r||!t)return l.NextResponse.json({error:"Course ID and Lead ID are required"},{status:400});let{data:o,error:n}=await u.from("leads").select("*").eq("id",t).single();if(n||!o)return l.NextResponse.json({error:"Lead not found"},{status:404});let{data:a,error:i}=await u.from("course_enrollments").select("id, enrollment_status, enrolled_at").eq("lead_id",t).eq("course_id",r).single();if(a&&!i)return l.NextResponse.json({error:"Already enrolled",message:"You are already enrolled in this course!",enrollment:a},{status:409});let{data:d,error:c}=await u.from("course_enrollments").insert({lead_id:t,course_id:r,payment_amount:s,enrollment_status:"enrolled",enrolled_at:new Date().toISOString()}).select().single();if(c){if(console.error("Enrollment error:",c),"23505"===c.code)return l.NextResponse.json({error:"Already enrolled",message:"You are already enrolled in this course!"},{status:409});return l.NextResponse.json({error:"Failed to create enrollment"},{status:500})}let{error:p}=await u.from("leads").update({career_goals:`${o.career_goals} | Enrolled in Course: ${r}`,updated_at:new Date().toISOString()}).eq("id",t);return p&&console.error("Lead update error:",p),l.NextResponse.json({success:!0,enrollment:d,message:"Successfully enrolled in course!"})}catch(e){return console.error("Course enrollment error:",e),l.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/courses/enroll/route",pathname:"/api/courses/enroll",filename:"route",bundlePath:"app/api/courses/enroll/route"},resolvedPagePath:"D:\\scaler-project\\Scalar-AI\\app\\api\\courses\\enroll\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:m}=d,x="/api/courses/enroll/route";function _(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[916,786,664,459],()=>t(9835));module.exports=s})();